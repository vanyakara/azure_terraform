name: Terraform Destroy Azure Resources

on:
  workflow_dispatch:  # –†—ä—á–Ω–æ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –æ—Ç GitHub UI

jobs:
  destroy:
    name: Terraform Destroy
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      # üîê –í—Ö–æ–¥ –≤ Azure
      - name: Azure Login
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      # üì¶ –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–µ –Ω–∞ Terraform
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
        with:
          terraform_version: 1.5.7

      # üß± –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      - name: Terraform Init
        run: terraform init

      # ‚ùå –£–Ω–∏—â–æ–∂–∞–≤–∞–Ω–µ –Ω–∞ —Ä–µ—Å—É—Ä—Å–∏—Ç–µ
      - name: Terraform Destroy
        run: |
          terraform destroy -auto-approve \
            -var="subscription_id=${{ secrets.AZURE_SUBSCRIPTION_ID }}" \
            -var="client_id=${{ secrets.AZURE_CLIENT_ID }}" \
            -var="client_secret=${{ secrets.AZURE_CLIENT_SECRET }}" \
            -var="tenant_id=${{ secrets.AZURE_TENANT_ID }}" \
            -var="admin_password=${{ secrets.AZURE_ADMIN_PASSWORD }}"
